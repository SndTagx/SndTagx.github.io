<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Interactive Morse code translator, sound player, and game.">
  <title>-..-</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: 'Courier New', monospace;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      --glow: rgba(255,255,255,0.8);
      --hl: #333;
      --act-bg: #fff;
      --act-txt: #000;
      --acc: #aaa;
    }

    *:focus { outline: none; }

    .bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.5;
      display: none;
    }

    .bg-vortex {
      background: radial-gradient(circle, rgba(255,255,255,0.2) 10%, transparent 10%, transparent 20%, rgba(255,255,255,0.2) 20%);
      animation: spin 12s linear infinite;
      display: block;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .glow {
      text-shadow: 0 0 10px var(--glow), 0 0 20px var(--acc);
      transition: text-shadow 0.3s;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      gap: 10px;
      overflow-y: auto;
    }

    .io {
      display: flex;
      flex-direction: column;
      flex: 1;
      gap: 10px;
    }

    textarea, .out {
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: 1px solid var(--acc);
      border-radius: 5px;
      padding: 10px;
      font-size: 16px;
      resize: none;
      flex: 1;
      min-height: 100px;
      width: 100%;
      box-sizing: border-box;
      box-shadow: 0 0 12px var(--glow);
      transition: box-shadow 0.3s, border-color 0.3s;
    }

    textarea:focus, button:focus, .tab:focus, .st:focus {
      box-shadow: 0 0 20px var(--glow), 0 0 30px var(--acc);
      border-color: var(--glow);
    }

    textarea::placeholder {
      color: rgba(255, 255, 255, 0.6);
      text-shadow: 0 0 5px var(--acc);
    }

    .out {
      white-space: pre-wrap;
      overflow-y: auto;
    }

    .snd-out, .game-out {
      min-height: 50px;
      flex: 0.5;
    }

    .ts {
      background: rgba(0,0,0,0.8);
      padding: 10px;
      display: flex;
      align-items: center;
      border-top: 1px solid var(--acc);
      position: fixed;
      bottom: 0;
      width: 100%;
      box-sizing: border-box;
      z-index: 10;
      box-shadow: 0 -5px 15px var(--glow);
      transition: transform 0.3s;
    }

    .tabs {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      white-space: nowrap;
      width: 100%;
      scrollbar-width: thin;
      scrollbar-color: var(--glow) #000;
    }

    .tabs::-webkit-scrollbar { height: 8px; }
    .tabs::-webkit-scrollbar-thumb { background: var(--glow); border-radius: 4px; }
    .tabs::-webkit-scrollbar-track { background: #000; }

    .tab {
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.3s;
      text-align: center;
      box-shadow: 0 0 8px var(--glow);
      flex-shrink: 0;
    }

    .tab:hover, .tab:focus {
      background: var(--hl);
      text-shadow: 0 0 15px var(--glow);
      transform: scale(1.1);
    }

    .tab.active {
      background: var(--act-bg);
      color: var(--act-txt);
      text-shadow: none;
      box-shadow: 0 0 20px var(--glow);
    }

    .tog {
      cursor: pointer;
      padding: 5px;
      position: fixed;
      bottom: 40px;
      right: 20px;
      background: rgba(0,0,0,0.8);
      border: 1px solid var(--acc);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      line-height: 30px;
      text-align: center;
      animation: pulse 2s infinite;
      z-index: 11;
      box-shadow: 0 0 15px var(--glow);
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 5px var(--glow); }
      50% { box-shadow: 0 0 20px var(--glow); }
    }

    .hid { display: none !important; }
    .hid-tabs { transform: translateY(100%); }

    .mt {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
      margin-top: 10px;
      padding: 10px;
      height: calc(100% - 20px);
      overflow-y: auto;
    }

    @media (min-width: 768px) {
      .mt { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }
    }

    @media (min-width: 1024px) {
      .mt { grid-template-columns: repeat(6, 1fr); }
    }

    .mi {
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      border: 1px solid var(--acc);
      box-shadow: 0 0 10px var(--glow);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .mi:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px var(--glow);
    }

    .snd-ctrl, .game-ctrl {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
    }

    button {
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: 1px solid var(--acc);
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Courier New', monospace;
      transition: all 0.3s;
      box-shadow: 0 0 10px var(--glow);
    }

    button:hover {
      background: var(--hl);
      box-shadow: 0 0 20px var(--glow);
      transform: scale(1.05);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-grp {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .game-ctrl.decode-mode #ph { display: none; }

    .sym {
      padding: 2px;
      border-radius: 3px;
      transition: background-color 0.2s;
    }

    .hl { background: var(--glow); }

    .sm {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
      border: 1px solid var(--acc);
      border-radius: 5px;
      box-shadow: 0 0 10px var(--glow);
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s, padding 0.3s;
    }

    .sm.open {
      max-height: 500px;
      padding: 15px;
    }

    .st {
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: 1px solid var(--acc);
      padding: 10px;
      font-family: 'Courier New', monospace;
      transition: all 0.3s;
      box-shadow: 0 0 10px var(--glow);
      text-align: center;
      cursor: pointer;
    }

    .st:hover {
      background: var(--hl);
      box-shadow: 0 0 20px var(--glow);
      transform: scale(1.05);
    }

    .sg {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
    }

    .sg input {
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: 1px solid var(--acc);
      border-radius: 3px;
      padding: 5px;
      font-family: 'Courier New', monospace;
      box-shadow: 0 0 10px var(--glow);
      width: 150px;
    }

    .game-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 10px;
    }

    .difficulty-button.active {
      background: var(--act-bg);
      color: var(--act-txt);
      box-shadow: 0 0 20px var(--glow);
    }

    .to {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .to input[type="checkbox"] {
      appearance: none;
      width: 40px;
      height: 20px;
      background: rgba(0,0,0,0.5);
      border: 1px solid var(--acc);
      border-radius: 10px;
      position: relative;
      cursor: pointer;
      box-shadow: 0 0 10px var(--glow);
    }

    .to input[type="checkbox"]:checked { background: var(--act-bg); }

    .to input[type="checkbox"]::before {
      content: '';
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      position: absolute;
      top: 2px;
      left: 2px;
      transition: transform 0.2s;
      box-shadow: 0 0 5px var(--glow);
    }

    .to input[type="checkbox"]:checked::before {
      transform: translateX(20px);
      background: var(--act-txt);
    }

    .fb {
      color: #0f0;
      min-height: 20px;
    }

    .fb.correct { animation: fg 0.5s; }
    .fb.incorrect { animation: shake 0.3s; color: #f00; }

    @keyframes fg {
      0%, 100% { background: transparent; }
      50% { background: rgba(0, 255, 0, 0.3); }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    .tut {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 20;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .tut.active {
      visibility: visible;
      opacity: 1;
    }

    .tm {
      background: rgba(0,0,0,0.8);
      border: 1px solid var(--acc);
      border-radius: 5px;
      padding: 20px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 0 20px var(--glow);
      transform: translateY(0);
    }

    .tm h2 { margin: 0 0 10px; }
    .tm p { margin: 0 0 20px; }

    .tut-btns {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .abt {
      padding: 20px;
      line-height: 1.6;
    }

    .abt h2 { margin-top: 0; }
    .abt ul { padding-left: 20px; }

    .hs {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    @media (max-width: 600px) {
      .mt { grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); }
      .btn-grp { flex-direction: column; }
      .tm { max-width: 90%; }
    }
  </style>
</head>
<body>
  <div class="bg bg-vortex" id="bg"></div>

  <div class="container">
    <div id="trans-tab" class="tab-content">
      <div class="io glow">
        <label for="i">Enter Text or Morse Code:</label>
        <textarea id="i" placeholder="Type text or Morse code here..." tabindex="1"></textarea>
        <label for="o">Output:</label>
        <div id="o" class="out" tabindex="2"></div>
      </div>
    </div>

    <div id="alpha-tab" class="tab-content hid">
      <div class="mt glow" id="mt"></div>
    </div>

    <div id="snd-tab" class="tab-content hid">
      <div class="snd-ctrl glow">
        <textarea id="si" placeholder="Type text or Morse code for sound..." tabindex="3"></textarea>
        <div id="so" class="out snd-out" tabindex="4">Morse code to play...</div>
        <div class="btn-grp">
          <button id="pm" tabindex="5">Play Morse Code</button>
          <button id="sm" tabindex="6">Stop Playback</button>
          <button id="pd" tabindex="7">.</button>
          <button id="pda" tabindex="8">-</button>
        </div>
        <button class="st" id="st" tabindex="9">Sound Settings ▼</button>
        <div class="sm glow" id="sm">
          <div class="sg">
            <label for="dd">Dot Duration (ms):</label>
            <input type="number" id="dd" min="50" max="200" step="1" value="100" tabindex="10">
            <label for="dad">Dash Duration (ms):</label>
            <input type="number" id="dad" min="150" max="600" step="1" value="300" tabindex="11">
            <label for="ss">Symbol Space (ms):</label>
            <input type="number" id="ss" min="50" max="200" step="1" value="100" tabindex="12">
            <label for="lsp">Letter Space (ms):</label>
            <input type="number" id="lsp" min="150" max="600" step="1" value="300" tabindex="13">
            <label for="ws">Word Space (ms):</label>
            <input type="number" id="ws" min="350" max="1400" step="1" value="700" tabindex="14">
          </div>
        </div>
      </div>
    </div>

    <div id="game-tab" class="tab-content hid">
      <div class="game-ctrl glow">
        <div class="game-section" id="gs">
          <h3>Start Morse Code Game</h3>
          <div class="hs">
            <div>Encode - Easy: <span id="hsee">0</span></div>
            <div>Encode - Medium: <span id="hsem">0</span></div>
            <div>Encode - Hard: <span id="hseh">0</span></div>
            <div>Encode - Extreme: <span id="hsex">0</span></div>
            <div>Decode - Easy: <span id="hsde">0</span></div>
            <div>Decode - Medium: <span id="hsdm">0</span></div>
            <div>Decode - Hard: <span id="hsdh">0</span></div>
            <div>Decode - Extreme: <span id="hsdx">0</span></div>
          </div>
          <div class="btn-grp">
            <button class="difficulty-button active" data-difficulty="easy" tabindex="15">Easy</button>
            <button class="difficulty-button" data-difficulty="medium" tabindex="16">Medium</button>
            <button class="difficulty-button" data-difficulty="hard" tabindex="17">Hard</button>
            <button class="difficulty-button" data-difficulty="extreme" tabindex="18">Extreme</button>
          </div>
          <div class="to">
            <label>Mode:</label>
            <input type="checkbox" id="gm" checked tabindex="19">
            <span id="ml">Encode (Text to Morse)</span>
          </div>
          <div>
            <input type="checkbox" id="soc" checked tabindex="20">
            <label for="soc">Show Input Translation</label>
          </div>
          <div>
            <input type="checkbox" id="lt" checked tabindex="21">
            <label for="lt">Enable Lives</label>
          </div>
          <button id="sg" tabindex="22">Start Game</button>
        </div>
        <div class="game-section hid" id="gp">
          <div id="gpr" tabindex="23"></div>
          <textarea id="gi" placeholder="Enter your answer..." tabindex="24"></textarea>
          <div id="go" class="out game-out hid" tabindex="25"></div>
          <div class="btn-grp">
            <button id="sa" tabindex="26">Submit Answer</button>
            <button id="ph" tabindex="27">Play Hint</button>
            <button id="stg" tabindex="28">Stop Game</button>
          </div>
          <div class="fb" id="gf" tabindex="29"></div>
          <div>Score: <span id="gsc">0</span></div>
          <div>Lives: <span id="gl">❤️❤️❤️</span></div>
        </div>
      </div>
    </div>

    <div id="abt-tab" class="tab-content hid">
      <div class="abt glow">
        <h2>About Morse Code</h2>
        <p>Morse code is a method used in telecommunication to encode text characters as sequences of two different signal durations, called dots and dashes.</p>
        <h3>History</h3>
        <p>Developed in the 1830s by Samuel Morse and Alfred Vail, Morse code was used extensively in telegraphy and early radio communication.</p>
        <h3>Uses</h3>
        <ul>
          <li>Maritime communication (e.g., SOS distress signal)</li>
          <li>Military operations</li>
          <li>Amateur radio</li>
          <li>Assistive technology for people with disabilities</li>
        </ul>
        <h3>Fun Facts</h3>
        <ul>
          <li>The SOS signal (…---…) was chosen for its simplicity, not as an acronym.</li>
          <li>Morse code is still used by some aviators and hobbyists today.</li>
          <li>It can be transmitted via light, sound, or even touch.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="ts">
    <div class="tabs">
      <div class="tab active glow" data-tab="trans" tabindex="30">Translator</div>
      <div class="tab glow" data-tab="alpha" tabindex="31">Alphabet</div>
      <div class="tab glow" data-tab="snd" tabindex="32">Sound</div>
      <div class="tab glow" data-tab="game" tabindex="33">Game</div>
      <div class="tab glow" data-tab="abt" tabindex="34">About</div>
    </div>
  </div>

  <div class="tog glow" id="ta" tabindex="35">▲</div>

  <div class="tut" id="to">
    <div class="tm glow">
      <h2>Welcome to Morse Code!</h2>
      <p id="tt"></p>
      <div class="tut-btns">
        <button id="ts" tabindex="36">Skip</button>
        <button id="tn" tabindex="37">Next</button>
      </div>
    </div>
  </div>

  <script>
    // Morse code mappings
    const mc = {
      'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.',
      'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---',
      'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---',
      'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-',
      'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--',
      'Z': '--..', '1': '.----', '2': '..---', '3': '...--',
      '4': '....-', '5': '.....', '6': '-....', '7': '--...',
      '8': '---..', '9': '----.', '0': '-----', ' ': '/'
    };

    // Reverse mapping for Morse to text
    const tfm = Object.fromEntries(Object.entries(mc).map(([k, v]) => [v, k]));

    // DOM elements
    const e = {
      i: document.getElementById('i'),
      o: document.getElementById('o'),
      si: document.getElementById('si'),
      so: document.getElementById('so'),
      t: document.querySelectorAll('.tab'),
      tc: document.querySelectorAll('.tab-content'),
      ta: document.getElementById('ta'),
      ts: document.querySelector('.ts'),
      mt: document.getElementById('mt'),
      pm: document.getElementById('pm'),
      sm: document.getElementById('sm'),
      pd: document.getElementById('pd'),
      pda: document.getElementById('pda'),
      dd: document.getElementById('dd'),
      dad: document.getElementById('dad'),
      ss: document.getElementById('ss'),
      lsp: document.getElementById('lsp'),
      ws: document.getElementById('ws'),
      st: document.getElementById('st'),
      smn: document.getElementById('sm'),
      gs: document.getElementById('gs'),
      gp: document.getElementById('gp'),
      sg: document.getElementById('sg'),
      gpr: document.getElementById('gpr'),
      gi: document.getElementById('gi'),
      go: document.getElementById('go'),
      sa: document.getElementById('sa'),
      ph: document.getElementById('ph'),
      stg: document.getElementById('stg'),
      gf: document.getElementById('gf'),
      gsc: document.getElementById('gsc'),
      gl: document.getElementById('gl'),
      db: document.querySelectorAll('.difficulty-button'),
      gm: document.getElementById('gm'),
      ml: document.getElementById('ml'),
      soc: document.getElementById('soc'),
      lt: document.getElementById('lt'),
      gc: document.querySelector('.game-ctrl'),
      to: document.getElementById('to'),
      tt: document.getElementById('tt'),
      ts: document.getElementById('ts'),
      tn: document.getElementById('tn'),
      hsee: document.getElementById('hsee'),
      hsem: document.getElementById('hsem'),
      hseh: document.getElementById('hseh'),
      hsex: document.getElementById('hsex'),
      hsde: document.getElementById('hsde'),
      hsdm: document.getElementById('hsdm'),
      hsdh: document.getElementById('hsdh'),
      hsdx: document.getElementById('hsdx')
    };

    // Audio context for sound playback
    const ac = new (window.AudioContext || window.webkitAudioContext)();
    let o = null; // Oscillator
    let ip = false; // Is playing

    // Sound settings
    let dd = 100; // Dot duration
    let dad = 300; // Dash duration
    let ss = 100; // Symbol space
    let lsp = 300; // Letter space
    let ws = 700; // Word space

    // Game state
    let cd = 'easy'; // Current difficulty
    let em = true; // Encode mode
    let so = true; // Show output
    let lt = true; // Lives toggle
    let cq = ''; // Current question
    let ca = ''; // Current answer
    let sc = 0; // Score
    let lv = 3; // Lives
    let hs = { // High scores
      encode: { easy: 0, medium: 0, hard: 0, extreme: 0 },
      decode: { easy: 0, medium: 0, hard: 0, extreme: 0 }
    };
    let sv = true; // Switcher visible

    // Tutorial steps
    const tts = [
      "Welcome! This app lets you translate, learn, and play with Morse code.",
      "Use the Translator tab to convert text to Morse code or vice versa.",
      "The Alphabet tab shows the Morse code for each character.",
      "In the Sound tab, hear your text or Morse code played aloud.",
      "Test your skills in the Game tab with encode or decode challenges.",
      "Enjoy!"
    ];
    let cts = 0; // Current tutorial step

    // Game words by difficulty
    const gw = {
      easy: [
        'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T',
        'U', 'V', 'W', 'X', 'Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
        'CAT', 'DOG', 'SUN', 'MOON', 'STAR', 'TREE', 'BIRD', 'PEN', 'HAT', 'BOX', 'CAR', 'KEY', 'SKY', 'SEA',
        'HILL', 'WIND', 'RAIN', 'SNOW', 'FISH', 'COW', 'PIG', 'ANT', 'BEE', 'FOX', 'WOLF', 'DEER', 'BEAR',
        'LION', 'TIGER', 'ZEBRA', 'SNAKE', 'EAGLE', 'OWL', 'BAT', 'RED', 'BLUE', 'GREEN', 'YELLOW', 'PINK',
        'BLACK', 'WHITE', 'GOLD', 'SILVER', 'ROSE', 'TULIP', 'OAK', 'MAPLE', 'PINE', 'CLOUD', 'STORM', 'FIRE',
        'ICE', 'DIRT', 'SAND', 'ROCK', 'PATH', 'ROAD', 'GATE', 'DOOR', 'WALL', 'FENCE', 'BRIDGE', 'BOAT',
        'SHIP', 'JET', 'BIKE', 'BALL', 'CUP', 'PLATE', 'FORK', 'SPOON', 'CHAIR', 'TABLE', 'BED', 'LAMP',
        'CLOCK', 'BAG', 'SHOE', 'COAT', 'SHIRT', 'PANTS', 'FARM', 'BARN', 'GOAT', 'SHEEP', 'DUCK', 'HORSE',
        'MULE', 'CORN', 'WHEAT', 'RICE', 'BEAN', 'PEA', 'FRUIT', 'GRAPE', 'LEMON', 'PEACH', 'PLUM', 'BERRY',
        'NUT', 'SEED', 'BUSH', 'VINE', 'LAWN', 'MOSS', 'FERN', 'PALM', 'CACTUS', 'BAMBOO', 'REED', 'WAVE',
        'TIDE', 'POND', 'CREEK', 'BROOK', 'FALL', 'POOL', 'SPRING', 'WELL'
      ],
      medium: [
        'HOUSE', 'SCHOOL', 'RIVER', 'FOREST', 'GOOD DAY', 'HI THERE', 'TRAIN', 'APPLE', 'BOOKS', 'QUICK FOX',
        'WARM SUN', 'COLD NIGHT', 'BRIGHT', 'DARK SKY', 'GREEN HILL', 'BLUE SEA', 'RED ROSE', ' WHITE SNOW',
        'YELLOW STAR', 'PINK CLOUD', 'GOLD RING', 'SILVER MOON', 'FARMER', 'BAKER', 'COOK', 'NURSE', 'DOCTOR',
        'PILOT', 'SINGER', 'DANCER', 'WRITER', 'PAINTER', 'BUILDER', 'DRIVER', 'TEACHER', 'MARKET', 'STORE',
        'SHOP', 'TOWN', 'CITY', 'VILLAGE', 'CASTLE', 'TOWER', 'BARN', 'SHED', 'HUT', 'TENT', 'CAMP', 'BEACH',
        'LAKE', 'POND', 'STREAM', 'BROOK', 'FALLS', 'CAVE', 'MINE', 'HALL', 'ROOM', 'KITCHEN', 'BATH',
        'BEDROOM', 'GARDEN', 'PARK', 'FIELD', 'MEADOW', 'DESERT', 'JUNGLE', 'SWAMP', 'PLAIN', 'VALLEY',
        'CANYON', 'CLIFF', 'RIDGE', 'PEAK', 'SUMMIT', 'TRAIL', 'WAVE', 'TIDE', 'SHORE', 'BREEZE', 'GUST',
        'STORM', 'FOG', 'MIST', 'HAIL', 'FROST', 'DEW', 'SPARK', 'FLAME', 'ASH', 'SMOKE', 'DUST', 'MUD',
        'CLAY', 'STONE', 'PEBBLE', 'BOULDER', 'GEM', 'CRYSTAL', 'METAL', 'WOOD', 'GLASS', 'PAPER', 'LEATHER',
        'CLOTH', 'STRING', 'ROPE', 'CHAIN', 'WHEEL', 'ENGINE', 'WINDOW', 'FLOOR', 'CEILING', 'STAIRS', 'ROOF',
        'LANTERN', 'CANDLE', 'ORCHARD', 'VINEYARD', 'PASTURE', 'HARVEST', 'CROP', 'PLOW', 'SOW', 'REAP',
        'GRAIN', 'FLOUR', 'BREAD', 'CHEESE', 'MILK', 'BUTTER', 'HONEY', 'JAM', 'SALT', 'SPICE', 'HERB',
        'MEAT', 'SOUP', 'STEW', 'PIE', 'CAKE', 'WINE', 'BEER', 'TEA', 'COFFEE', 'SUGAR', 'CANDY', 'TOY',
        'DOLL', 'KITE', 'DRUM', 'FLUTE', 'SONG', 'POEM', 'TALE', 'MYTH', 'LEGEND', 'RIDDLE', 'JOKE', 'PLAY',
        'DANCE', 'FEAST', 'PARTY'
      ],
      hard: [
        'SAVE OUR SHIP', 'GOOD MORNING', 'CALL FOR HELP', 'MEET AT NOON', 'EMERGENCY CALL', 'SEND MESSAGE',
        'WEATHER REPORT', 'ARRIVE TONIGHT', 'CHECK POSITION', 'REQUEST AID', 'DISTRESS SIGNAL', 'CLEAR THE WAY',
        'STAY ON COURSE', 'CHANGE DIRECTION', 'FULL SPEED AHEAD', 'STOP IMMEDIATELY', 'RETURN TO BASE',
        'PREPARE TO LAND', 'TAKE OFF NOW', 'CONFIRM ARRIVAL', 'REPORT STATUS', 'MAINTAIN RADIO',
        'SWITCH FREQUENCY', 'SEND COORDINATES', 'EVACUATE AREA', 'SECURE THE ZONE', 'DEPLOY TEAM',
        'RESCUE OPERATION', 'SUPPLY DROP', 'MEDICAL AID', 'SEARCH AND FIND', 'LOCATE TARGET',
        'ESTABLISH CONTACT', 'BREAK SILENCE', 'REPEAT MESSAGE', 'VERIFY SIGNAL', 'STANDBY FOR INFO',
        'UPDATE REQUIRED', 'MISSION COMPLETE', 'ABORT OPERATION', 'HOLD POSITION', 'ADVANCE FORWARD',
        'RETREAT NOW', 'DEFEND THE LINE', 'ATTACK AT DAWN', 'CEASE FIRE', 'NEGOTIATE PEACE',
        'SIGN THE TREATY', 'DECLARE VICTORY', 'SURRENDER NOW', 'RAISE THE FLAG', 'LOWER THE SAILS',
        'ANCHOR THE SHIP', 'LOAD THE CARGO', 'UNLOAD SUPPLIES', 'INSPECT THE GEAR', 'REPAIR THE HULL',
        'REFUEL THE JET', 'RECHARGE POWER', 'ACTIVATE SYSTEM', 'SHUTDOWN ENGINE', 'OPEN THE GATES',
        'CLOSE THE DOORS', 'LOCK THE VAULT', 'UNLOCK THE CODE', 'HACK THE SYSTEM', 'BYPASS SECURITY',
        'INSTALL UPDATE', 'RUN DIAGNOSTICS', 'CHECK THE MAP', 'PLOT THE ROUTE', 'FOLLOW THE PATH',
        'AVOID THE STORM', 'CROSS THE BRIDGE', 'CLIMB THE PEAK', 'DESCEND THE CLIFF', 'ENTER THE CAVE',
        'EXIT THE TUNNEL', 'EXPLORE THE RUINS', 'DISCOVER TREASURE', 'COLLECT SAMPLES', 'ANALYZE DATA',
        'RECORD FINDINGS', 'PUBLISH REPORT', 'SHARE THE NEWS', 'BROADCAST LIVE', 'STREAM THE EVENT',
        'HOST THE SHOW', 'INVITE GUESTS', 'PLAN THE TRIP', 'BOOK THE FLIGHT', 'RENT THE CAR',
        'RESERVE A ROOM', 'PACK THE BAGS', 'BOARD THE TRAIN', 'CATCH THE BUS', 'WATCH THE SKY',
        'LISTEN TO WIND', 'FEEL THE RAIN', 'TOUCH THE STARS', 'DREAM OF PEACE', 'HOPE FOR LOVE',
        'LIVE FOR TODAY', 'BUILD TOMORROW', 'RADIO CHECK', 'OVERRIDE SYSTEM', 'LAUNCH SEQUENCE',
        'NAVIGATION ERROR', 'SYSTEM FAILURE', 'CRITICAL ALERT', 'EMERGENCY EXIT', 'BACKUP POWER',
        'REBOOT SYSTEM', 'CALIBRATE SENSOR', 'TRANSMIT DATA', 'RECEIVE SIGNAL', 'DECODE MESSAGE',
        'ENCRYPT CODE', 'SATELLITE LINK', 'ORBITAL PATH', 'GRAVITY PULL', 'SOLAR FLARE',
        'METEOR SHOWER', 'SPACE STATION', 'LUNAR SURFACE', 'MARTIAN SOIL', 'GALACTIC CORE',
        'REQUEST BACKUP', 'INITIATE PROTOCOL', 'ENGAGE TARGET', 'MONITOR FREQUENCY', 'SECURE PERIMETER',
        'LAUNCH MISSILE', 'DEACTIVATE ALARM', 'RECONFIGURE SYSTEM', 'UPLOAD DATA', 'DOWNLOAD FILE',
        'ESTABLISH LINK', 'TERMINATE CONNECTION', 'EXECUTE COMMAND', 'OVERRIDE CONTROLS',
        'NAVIGATE TERRAIN', 'SURVEY AREA', 'COLLECT EVIDENCE', 'INTERCEPT SIGNAL', 'JAM TRANSMISSION',
        'REINFORCE POSITION', 'EVACUATE PERSONNEL', 'DEPLOY DRONE', 'ACTIVATE SHIELD',
        'DETONATE CHARGE', 'INFILTRATE BASE', 'EXTRACT ASSET', 'NEUTRALIZE THREAT', 'RECALL UNIT'
      ],
      extreme: [
        'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',
        'ZYXWVUTSRQPONMLKJIHGFEDCBA9876543210',
        'THEQUICKBROWNFOXJUMPEDOVERTHELAZYDOG123',
        '0987654321ABCDEFGHIJKLMNOPQRSTUVWXYZ',
        'CRYPTOGRAPHICSECURECOMMUNICATIONSYSTEMS',
        'SATELLITENAVIGATIONANDPOSITIONINGDATA',
        'INTERCONTINENTALBALLISTICMISSILEGUIDANCE',
        'QUANTUMCOMPUTATIONALGORITHMOPTIMIZATION',
        'DEOXYRIBONUCLEICACIDSEQUENCEANALYSIS',
        'ELECTROMAGNETICSPECTRUMFREQUENCYMODULATION',
        'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890ZYX',
        '9876543210ZYXWVUTSRQPONMLKJIHGFEDCBA',
        'THEBIGDWARFONLYJUMPEDANDRAN1234567890',
        'COMPLEXMATHEMATICALEQUATIONRESOLUTION',
        'ADVANCEDARTIFICIALINTELLIGENCEMODELS',
        'HYPERSONICVEHICLETRAJECTORYCALCULATION',
        'GLOBALPOSITIONINGSATELLITEDATASTREAM',
        'NEURALNETWORKDEEPLEARNINGALGORITHM',
        'THERMODYNAMICENTROPYCALCULATIONFORMULA',
        'SUBATOMICPARTICLECOLLISIONEXPERIMENT',
        'ZYXWVUTSRQPONMLKJIHGFEDCBA0123456789',
        '1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ',
        'ENCRYPTEDMILITARYCOMMUNICATIONPROTOCOL',
        'SATELLITEORBITALMECHANICSCALCULATIONS',
        'QUANTUMENTANGLEMENTCOMMUNICATIONTHEORY',
        'BIOMETRICAUTHENTICATIONSECURITYSYSTEM',
        'SUPERNOVASTELLARCORECOLLAPSESIMULATION',
        'HOLOGRAPHICDATAPROJECTIONTECHNOLOGY',
        'NEUROTRANSMITTERSYNAPTICFIRINGPATTERN',
        'INTERSTELLARSPACECRAFTNAVIGATIONPLAN',
        'ABCDEFGHIJKLMNOPQRSTUVWXYZ9876543210',
        '0123456789ZYXWVUTSRQPONMLKJIHGFEDCBA',
        'THEQUICKFOXJUMPEDANDRANFARAWAY123456',
        'CRYPTOCURRENCYBLOCKCHAINTRANSACTIONLEDGER',
        'QUANTUMCRYPTOGRAPHYKEYDISTRIBUTION',
        'HYPERDIMENSIONALPHYSICSTHEORYMODEL',
        'GENETICMUTATIONEVOLUTIONARYBIOLOGY',
        'PARTICLEACCELERATORCOLLISIONANALYSIS',
        'EXTRATERRESTRIALSIGNALDETECTIONPROTOCOL',
        'NEURALINTERFACEBRAINCOMPUTERINTEGRATION',
        'ASTROPHYSICALBLACKHOLEEVENTHORIZON',
        'INTERGALACTICCOMMUNICATIONFREQUENCYSPECTRUM',
        'CYBERSECURITYINTRUSIONDETECTIONSYSTEM',
        'QUANTUMFIELDINTERACTIONMATRIXCALCULATION',
        'BIOTECHNOLOGICALGENEEDITINGCRISPRCAS9',
        'SPACETIMEGRAVITATIONALWAVEOBSERVATION',
        'MULTIDIMENSIONALDATAVISUALIZATIONTOOL',
        'ADVANCEDROBOTICSAUTOMATIONFRAMEWORK',
        'THEULTIMATECHALLENGEOFMORSECODEMASTERY',
        'ZYXWVUTSRQPONMLKJIHGFEDCBA9876543210ABC'
      ]
    };

    // Load settings from localStorage
    const ls = window.localStorage;
    const load = () => {
      try {
        if (!ls) return;
        dd = +ls.getItem('dd') || 100;
        dad = +ls.getItem('dad') || 300;
        ss = +ls.getItem('ss') || 100;
        lsp = +ls.getItem('lsp') || 300;
        ws = +ls.getItem('ws') || 700;
        so = ls.getItem('so') !== 'false';
        cd = ls.getItem('cd') || 'easy';
        em = ls.getItem('em') !== 'false';
        lt = ls.getItem('lt') !== 'false';
        sc = +ls.getItem('sc') || 0;
        lv = +ls.getItem('lv') || 3;
        hs = JSON.parse(ls.getItem('hs')) || {
          encode: { easy: 0, medium: 0, hard: 0, extreme: 0 },
          decode: { easy: 0, medium: 0, hard: 0, extreme: 0 }
        };
        cq = ls.getItem('cq') || '';
        ca = ls.getItem('ca') || '';

        e.i.value = ls.getItem('ti') || '';
        e.si.value = ls.getItem('si') || '';
        e.gi.value = ls.getItem('gi') || '';
        e.o.textContent = ls.getItem('to') || '';
        e.so.textContent = ls.getItem('so') || 'Morse code to play...';
        e.go.textContent = ls.getItem('go') || '';

        e.dd.value = dd;
        e.dad.value = dad;
        e.ss.value = ss;
        e.lsp.value = lsp;
        e.ws.value = ws;
        e.soc.checked = so;
        e.gm.checked = em;
        e.lt.checked = lt;
        e.ml.textContent = em ? 'Encode (Text to Morse)' : 'Decode (Morse to Text)';
        e.gsc.textContent = sc;
        e.gl.textContent = '❤️'.repeat(lv);
        e.hsee.textContent = hs.encode.easy;
        e.hsem.textContent = hs.encode.medium;
        e.hseh.textContent = hs.encode.hard;
        e.hsex.textContent = hs.encode.extreme;
        e.hsde.textContent = hs.decode.easy;
        e.hsdm.textContent = hs.decode.medium;
        e.hsdh.textContent = hs.decode.hard;
        e.hsdx.textContent = hs.decode.extreme;
        e.gc.classList.toggle('decode-mode', !em);

        const at = ls.getItem('at') || 'trans';
        st(at);

        e.db.forEach(btn => {
          btn.classList.toggle('active', btn.dataset.difficulty === cd);
        });

        if (cq && ls.getItem('ga') === 'true') {
          e.gs.classList.add('hid');
          e.gp.classList.remove('hid');
          e.gpr.textContent = em ? `Encode: ${cq}` : `Decode: ${cq}`;
          e.sa.disabled = !e.gi.value.trim();
        } else {
          e.gs.classList.remove('hid');
          e.gp.classList.add('hid');
          cq = '';
          ca = '';
          lv = 3;
          e.gl.textContent = '❤️'.repeat(lv);
        }
      } catch (err) {
        console.warn('Failed to load settings:', err);
      }
    };

    // Save settings to localStorage
    const save = () => {
      try {
        if (!ls) return;
        ls.setItem('dd', String(dd));
        ls.setItem('dad', String(dad));
        ls.setItem('ss', String(ss));
        ls.setItem('lsp', String(lsp));
        ls.setItem('ws', String(ws));
        ls.setItem('so', String(so));
        ls.setItem('cd', cd);
        ls.setItem('em', String(em));
        ls.setItem('lt', String(lt));
        ls.setItem('sc', String(sc));
        ls.setItem('lv', String(lv));
        ls.setItem('hs', JSON.stringify(hs));
        ls.setItem('cq', cq || '');
        ls.setItem('ca', ca || '');
        ls.setItem('ga', e.gp.classList.contains('hid') ? 'false' : 'true');
        ls.setItem('at', document.querySelector('.tab.active')?.dataset.tab || 'trans');
      } catch (err) {
        console.warn('Failed to save settings:', err);
      }
    };

    // Save input to localStorage
    const si = (el, k) => {
      try {
        if (!ls) return;
        ls.setItem(k, el.value || '');
      } catch (err) {
        console.warn(`Failed to save ${k}:`, err);
      }
    };

    // Save output to localStorage
    const soo = (el, k) => {
      try {
        if (!ls) return;
        ls.setItem(k, el.textContent || '');
      } catch (err) {
        console.warn(`Failed to save ${k}:`, err);
      }
    };

    // Generate Morse code table
    const gmt = () => {
      e.mt.innerHTML = '';
      for (const [c, d] of Object.entries(mc)) {
        const i = document.createElement('div');
        i.className = 'mi';
        i.innerHTML = `<strong>${c}</strong><br>${d}`;
        i.tabIndex = 0;
        e.mt.appendChild(i);
      }
    };

    // Normalize Morse code input
    const nm = m => m ? m.trim().replace(/\s*\/\s*/g, ' / ').replace(/\s+/g, ' ').trim() : '';

    // Convert text to Morse code
    const ttm = t => {
      if (!t) return '';
      return t.toUpperCase()
        .split(' ')
        .map(w => w.split('').map(c => mc[c] || '').filter(c => c).join(' '))
        .filter(w => w)
        .join(' / ');
    };

    // Convert Morse code to text
    const mtt = m => {
      if (!m) return '';
      m = nm(m);
      return m.split(' / ')
        .map(w => w.split(' ').map(c => tfm[c] || '').filter(c => c).join(''))
        .filter(w => w)
        .join(' ');
    };

    // Debounce function
    const deb = (f, w) => {
      let t;
      return (...a) => {
        clearTimeout(t);
        t = setTimeout(() => f(...a), w);
      };
    };

    // Update translator output
    const uto = deb(() => {
      const t = e.i.value.trim();
      e.o.textContent = /^[.\-\/ ]+$/.test(t) ? mtt(t) : ttm(t);
      soo(e.o, 'to');
    }, 300);

    // Update sound output
    const uso = deb(() => {
      const t = e.si.value.trim();
      const m = /^[.\-\/ ]+$/.test(t) ? nm(t) : ttm(t);
      if (!t) {
        e.so.textContent = 'Morse code to play...';
      } else {
        e.so.innerHTML = m.split('').map((s, i) => `<span class="sym" data-index="${i}">${s}</span>`).join('');
      }
      soo(e.so, 'so');
    }, 300);

    // Update game output
    const ugo = deb(() => {
      if (!so) {
        e.go.classList.add('hid');
        return;
      }
      e.go.classList.remove('hid');
      const t = e.gi.value.trim();
      if (!t) {
        e.go.textContent = '';
      } else {
        e.go.innerHTML = (em ? mtt(t) : ttm(t)).split('').map((s, i) => `<span class="sym" data-index="${i}">${s}</span>`).join('');
      }
      soo(e.go, 'go');
    }, 300);

    // Play a single Morse symbol
    const ps = async s => {
      if (ip || o) return;
      ip = true;
      e.pm.disabled = true;

      o = ac.createOscillator();
      o.type = 'sine';
      o.frequency.setValueAtTime(600, ac.currentTime);
      o.connect(ac.destination);
      o.start();

      const dur = s === '.' ? dd : dad;
      await new Promise(r => setTimeout(r, dur));

      o.stop();
      o = null;
      ip = false;
      e.pm.disabled = false;
    };

    // Play Morse code sequence
    const pmc = async (m, oe) => {
      if (ip) return;
      ip = true;
      e.pm.disabled = true;
      e.ph.disabled = true;

      const ie = oe === e.so ? e.si : e.gi;
      ie.disabled = true;
      ie.style.cursor = 'not-allowed';

      if (!m) {
        ie.disabled = false;
        ie.style.cursor = 'auto';
        ip = false;
        e.pm.disabled = false;
        e.ph.disabled = false;
        return;
      }

      m = nm(m);
      const c = /^[.\-\/ ]+$/.test(m) ? m.split(' ') : ttm(m).split(' ');
      let si = 0;

      for (const d of c) {
        if (!ip) break;

        if (d === '/') {
          const s = oe.querySelector(`[data-index="${si}"]`);
          if (s) {
            s.classList.add('hl');
            await new Promise(r => setTimeout(r, ws));
            s.classList.remove('hl');
          }
          si += 2;
          continue;
        }

        for (const s of d) {
          if (!ip) break;

          const cs = oe.querySelector(`[data-index="${si}"]`);
          if (cs) cs.classList.add('hl');

          o = ac.createOscillator();
          o.type = 'sine';
          o.frequency.setValueAtTime(600, ac.currentTime);
          o.connect(ac.destination);
          o.start();

          const dur = s === '.' ? dd : dad;
          await new Promise(r => setTimeout(r, dur));

          o.stop();
          if (cs) cs.classList.remove('hl');

          await new Promise(r => setTimeout(r, ss));
          si++;
        }

        await new Promise(r => setTimeout(r, lsp - ss));
        si++;
      }

      ie.disabled = false;
      ie.style.cursor = 'auto';
      ip = false;
      e.pm.disabled = false;
      e.ph.disabled = false;
    };

    // Stop Morse code playback
    const smc = oe => {
      ip = false;
      if (o) {
        o.stop();
        o = null;
      }
      const ie = oe === e.so ? e.si : e.gi;
      ie.disabled = false;
      ie.style.cursor = 'auto';
      oe.querySelectorAll('.sym').forEach(s => s.classList.remove('hl'));
      e.pm.disabled = false;
      e.ph.disabled = false;
    };

    // Generate game question
    const gq = () => {
      const w = gw[cd];
      const word = w[Math.floor(Math.random() * w.length)];
      cq = em ? word : ttm(word);
      ca = em ? ttm(word) : word;
      e.gpr.textContent = em ? `Encode: ${cq}` : `Decode: ${cq}`;
      e.gi.value = '';
      e.gf.textContent = '';
      e.gf.classList.remove('correct', 'incorrect');
      e.sa.disabled = true;
      save();
      si(e.gi, 'gi');
      ugo();
    };

    // Check game answer
    const chkAns = async () => {
      e.sa.disabled = true;
      const ua = e.gi.value.trim();
      const nua = em ? nm(ua.toUpperCase()) : ua.toUpperCase();
      const nca = em ? nm(ca) : ca.toUpperCase();
      const ic = nua === nca;
      const m = em ? 'encode' : 'decode';

      if (ic) {
        sc++;
        e.gf.textContent = 'Correct!';
        e.gf.classList.add('correct');
        e.gf.classList.remove('incorrect');
        if (sc > hs[m][cd]) {
          hs[m][cd] = sc;
          e[`hs${m.slice(0, 3)}${cd.slice(0, 3)}`].textContent = sc;
        }
        e.gsc.textContent = sc;
        save();
        await new Promise(r => setTimeout(r, 1000));
        gq();
      } else {
        if (lt) lv--;
        e.gl.textContent = '❤️'.repeat(lv);
        e.gf.textContent = `Incorrect. Correct answer: ${ca}`;
        e.gf.classList.add('incorrect');
        e.gf.classList.remove('correct');
        save();
        if (lt && lv <= 0) {
          e.gf.textContent = `Game Over! Final Score: ${sc}`;
          await new Promise(r => setTimeout(r, 2000));
          sg();
        } else {
          await new Promise(r => setTimeout(r, 2000));
          e.gf.textContent = '';
          e.gf.classList.remove('correct', 'incorrect');
          e.sa.disabled = false;
        }
      }
    };

    // Stop game
    const sg = () => {
      sc = 0;
      lv = 3;
      cq = '';
      ca = '';
      e.gsc.textContent = sc;
      e.gl.textContent = '❤️'.repeat(lv);
      e.gpr.textContent = '';
      e.gi.value = '';
      e.gf.textContent = '';
      e.gf.classList.remove('correct', 'incorrect');
      e.go.textContent = '';
      e.gp.classList.add('hid');
      e.gs.classList.remove('hid');
      smc(e.go);
      e.sa.disabled = false;
      save();
      si(e.gi, 'gi');
      soo(e.go, 'go');
    };

    // Update sound setting
    const us = (i, min, max, k) => {
      let v = +i.value;
      v = isNaN(v) || v < min ? min : v > max ? max : v;
      i.value = v;
      window[k] = v;
      save();
    };

    // Switch tabs
    const st = tn => {
      e.t.forEach(t => t.classList.remove('active'));
      e.tc.forEach(c => c.classList.add('hid'));
      const te = document.querySelector(`.tab[data-tab="${tn}"]`);
      if (te) te.classList.add('active');
      document.getElementById(`${tn}-tab`).classList.remove('hid');
      save();
    };

    // Event listeners
    e.t.forEach(t => t.addEventListener('click', () => st(t.dataset.tab)));

    e.ta.addEventListener('click', () => {
      sv = !sv;
      e.ts.classList.toggle('hid-tabs', !sv);
      e.ta.textContent = sv ? '▲' : '▼';
    });

    e.i.addEventListener('input', () => {
      uto();
      si(e.i, 'ti');
    });

    e.si.addEventListener('input', () => {
      uso();
      si(e.si, 'si');
    });

    e.gi.addEventListener('input', () => {
      e.sa.disabled = !e.gi.value.trim();
      ugo();
      si(e.gi, 'gi');
    });

    e.pm.addEventListener('click', () => pmc(e.si.value.trim(), e.so));
    e.sm.addEventListener('click', () => smc(e.so));
    e.pd.addEventListener('click', () => ps('.'));
    e.pda.addEventListener('click', () => ps('-'));

    e.dd.addEventListener('input', () => us(e.dd, 50, 200, 'dd'));
    e.dad.addEventListener('input', () => us(e.dad, 150, 600, 'dad'));
    e.ss.addEventListener('input', () => us(e.ss, 50, 200, 'ss'));
    e.lsp.addEventListener('input', () => us(e.lsp, 150, 600, 'lsp'));
    e.ws.addEventListener('input', () => us(e.ws, 350, 1400, 'ws'));

    e.st.addEventListener('click', () => {
      const o = e.smn.classList.toggle('open');
      e.st.textContent = `Sound Settings ${o ? '▲' : '▼'}`;
    });

    e.db.forEach(b => {
      b.addEventListener('click', () => {
        e.db.forEach(btn => btn.classList.remove('active'));
        b.classList.add('active');
        cd = b.dataset.difficulty;
        if (cq) gq();
        save();
      });
    });

    e.gm.addEventListener('change', () => {
      em = e.gm.checked;
      e.ml.textContent = em ? 'Encode (Text to Morse)' : 'Decode (Morse to Text)';
      e.gc.classList.toggle('decode-mode', !em);
      if (cq) gq();
      save();
    });

    e.soc.addEventListener('change', () => {
      so = e.soc.checked;
      save();
      ugo();
    });

    e.lt.addEventListener('change', () => {
      lt = e.lt.checked;
      save();
    });

    e.sg.addEventListener('click', () => {
      e.gs.classList.add('hid');
      e.gp.classList.remove('hid');
      sc = 0;
      lv = 3;
      e.gsc.textContent = sc;
      e.gl.textContent = '❤️'.repeat(lv);
      gq();
      save();
    });

    e.sa.addEventListener('click', chkAns);
    e.ph.addEventListener('click', () => pmc(cq, e.go));
    e.stg.addEventListener('click', sg);

    e.tn.addEventListener('click', () => {
      cts++;
      if (cts < tts.length) {
        e.tt.textContent = tts[cts];
      } else {
        e.to.classList.remove('active');
        ls.setItem('tc', 'true');
      }
    });

    e.ts.addEventListener('click', () => {
      e.to.classList.remove('active');
      ls.setItem('tc', 'true');
    });

    document.addEventListener('keydown', ev => {
      if (ev.key === 'Enter' && document.activeElement === e.gi) chkAns();
      if (ev.key === 't') {
        const ct = document.querySelector('.tab.active');
        const at = Array.from(e.t);
        const ci = at.indexOf(ct);
        const ni = (ci + 1) % at.length;
        st(at[ni].dataset.tab);
      }
    });

    // Resume audio context on first interaction
    document.addEventListener('click', () => {
      if (ac.state === 'suspended') ac.resume();
    }, { once: true });

    // Initialize
    gmt();
    load();
    uso();
    uto();
    ugo();
  </script>
</body>
</html>
