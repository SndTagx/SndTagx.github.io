<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SndTagXClicker</title>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(45deg, #1e1e2f, #3b3b5e);
            font-family: Arial, sans-serif;
            color: #e0e0e0;
            user-select: none;
        }
        #mainButton {
            width: 100%;
            height: 100vh;
            background-size: cover;
            background-position: center;
            border: none;
            cursor: pointer;
            outline: none;
            transition: transform 0.2s ease;
        }
        #mainButton:hover { transform: scale(1.02); }
        #mainButton:active { transform: scale(0.98); }
        #clickArea {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 26px;
            display: flex;
            align-items: center;
            background: rgba(20, 20, 40, 0.9);
            padding: 8px 12px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 150;
        }
        #coinIcon { width: 32px; height: 32px; margin-right: 10px; }
        #coinCount { font-size: 26px; }
        .flying-coin {
            position: absolute;
            width: 32px;
            height: 32px;
            pointer-events: none;
            animation: flyUp 1s ease-out forwards;
        }
        @keyframes flyUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(0.8); }
        }
        #upgradeButton, #rebirthButton {
            position: absolute;
            bottom: 10px;
            padding: 8px 12px;
            background-size: cover;
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            width: 150px;
            height: 45px;
            z-index: 100;
        }
        #upgradeButton { left: 10px; }
        #rebirthButton { right: 10px; }
        #upgradeButton:disabled, #rebirthButton:disabled { opacity: 0.6; cursor: not-allowed; }
        #upgradeCostLabel, #rebirthCostLabel, #upgradeCountLabel, #rebirthCountLabel {
            position: absolute;
            font-size: 12px;
            padding: 4px 6px;
            border-radius: 8px;
            background: #000;
            z-index: 100;
        }
        #upgradeCostLabel { bottom: 60px; left: 10px; color: #00b4db; }
        #upgradeCountLabel { bottom: 80px; left: 10px; color: #00b4db; }
        #rebirthCostLabel { bottom: 60px; right: 10px; color: #ff4d4d; }
        #rebirthCountLabel { bottom: 80px; right: 10px; color: #ff4d4d; }
        #settingsToggle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background: #1e1e2f;
            border: 2px solid #173a5b;
            border-radius: 50%;
            color: #fff;
            font-size: 26px;
            cursor: pointer;
            z-index: 101;
        }
        #settingsPanel {
            position: absolute;
            top: 60px;
            right: 10px;
            width: 260px;
            background: rgba(20, 20, 40, 0.95);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.6);
            display: none;
            z-index: 100;
        }
        .setting-option {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 15px;
        }
        #settingsPanel input, #settingsPanel button {
            margin: 5px;
            padding: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        #authMessage { font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>
    <button id="mainButton"></button>
    <div id="clickArea">
        <img id="coinIcon" alt="Coin">
        <span id="coinCount">0</span>
    </div>
    <div id="upgradeCountLabel">Count: 0</div>
    <div id="upgradeCostLabel">Cost: 10</div>
    <button id="upgradeButton">Upgrade</button>
    <div id="rebirthCountLabel">Count: 0</div>
    <div id="rebirthCostLabel">Cost: 1000000</div>
    <button id="rebirthButton">Rebirth</button>
    <button id="settingsToggle">âš™</button>
    <div id="settingsPanel">
        <div class="setting-option">
            <input type="text" id="usernameInput" placeholder="Username">
            <input type="password" id="passwordInput" placeholder="Password">
            <button id="loginButton">Login</button>
            <button id="signupButton">Sign Up</button>
            <button id="logoutButton" style="display: none;">Logout</button>
            <div id="authMessage"></div>
        </div>
        <div class="setting-option">
            <button id="saveButton">Save to Cloud</button>
        </div>
    </div>
    <audio id="clickSound"></audio>

    <script>
        // Firebase configuration (replace apiKey with your new key)
        const firebaseConfig = {
            apiKey: "AIzaSyB-fkxockaYaRFtjKserdeY1YJXzRyE_zk", // Get from Firebase Console
            authDomain: "sndtagx.firebaseapp.com",
            projectId: "sndtagx",
            storageBucket: "sndtagx.firebasestorage.app",
            messagingSenderId: "1057888777099",
            appId: "1:1057888777099:web:243410f285cd9e9500f58e",
            measurementId: "G-B7KVZZ3J86"
        };

        // Wait for Firebase to load
        window.onload = function() {
            // Initialize Firebase
            try {
                firebase.initializeApp(firebaseConfig);
                console.log("Firebase initialized");
            } catch (e) {
                console.error("Firebase init failed:", e);
                alert("Firebase setup failed. Check console for details.");
                return;
            }

            const auth = firebase.auth();
            const db = firebase.firestore();
            const FIXED_DOMAIN = "@sndtagx.com";

            // DOM elements
            const mainButton = document.getElementById('mainButton');
            const coinCount = document.getElementById('coinCount');
            const coinIcon = document.getElementById('coinIcon');
            const upgradeButton = document.getElementById('upgradeButton');
            const rebirthButton = document.getElementById('rebirthButton');
            const upgradeCostLabel = document.getElementById('upgradeCostLabel');
            const upgradeCountLabel = document.getElementById('upgradeCountLabel');
            const rebirthCostLabel = document.getElementById('rebirthCostLabel');
            const rebirthCountLabel = document.getElementById('rebirthCountLabel');
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsPanel = document.getElementById('settingsPanel');
            const usernameInput = document.getElementById('usernameInput');
            const passwordInput = document.getElementById('passwordInput');
            const loginButton = document.getElementById('loginButton');
            const signupButton = document.getElementById('signupButton');
            const logoutButton = document.getElementById('logoutButton');
            const authMessage = document.getElementById('authMessage');
            const saveButton = document.getElementById('saveButton');
            const clickSound = document.getElementById('clickSound');

            // Game state
            let user = null;
            let count = parseInt(localStorage.getItem('coinCount')) || 0;
            let coinsPerClick = parseInt(localStorage.getItem('coinsPerClick')) || 1;
            let upgradeLevel = parseInt(localStorage.getItem('upgradeLevel')) || 0;
            let rebirths = parseInt(localStorage.getItem('rebirths')) || 0;
            let upgradeCost = parseInt(localStorage.getItem('upgradeCost')) || 10;
            let rebirthCost = parseInt(localStorage.getItem('rebirthCost')) || 1000000;
            const defaultSkin = "Skins/SvetlanaSkin.jpg";
            const defaultSound = "Sounds/SvetlanaSkin.mp3";

            // Initial setup
            mainButton.style.backgroundImage = `url('${defaultSkin}')`;
            upgradeButton.style.backgroundImage = `url('${defaultSkin}')`;
            rebirthButton.style.backgroundImage = `url('${defaultSkin}')`;
            coinIcon.src = defaultSkin;
            clickSound.src = defaultSound;
            coinCount.textContent = count;
            upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
            upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
            rebirthCostLabel.textContent = `Cost: ${rebirthCost}`;
            rebirthCountLabel.textContent = `Count: ${rebirths}`;
            updateButtons();

            // Authentication
            auth.onAuthStateChanged(firebaseUser => {
                user = firebaseUser;
                if (user) {
                    usernameInput.style.display = 'none';
                    passwordInput.style.display = 'none';
                    loginButton.style.display = 'none';
                    signupButton.style.display = 'none';
                    logoutButton.style.display = 'block';
                    authMessage.textContent = `Logged in as ${user.email.split('@')[0]}`;
                    loadFromFirestore();
                } else {
                    usernameInput.style.display = 'inline';
                    passwordInput.style.display = 'inline';
                    loginButton.style.display = 'inline';
                    signupButton.style.display = 'inline';
                    logoutButton.style.display = 'none';
                    authMessage.textContent = 'Not logged in';
                }
            });

            loginButton.addEventListener('click', () => {
                const email = usernameInput.value.trim() + FIXED_DOMAIN;
                const password = passwordInput.value;
                if (!email || !password) {
                    authMessage.textContent = 'Enter username and password';
                    return;
                }
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => authMessage.textContent = 'Login successful!')
                    .catch(e => authMessage.textContent = `Error: ${e.message}`);
            });

            signupButton.addEventListener('click', () => {
                const email = usernameInput.value.trim() + FIXED_DOMAIN;
                const password = passwordInput.value;
                if (!email || !password) {
                    authMessage.textContent = 'Enter username and password';
                    return;
                }
                auth.createUserWithEmailAndPassword(email, password)
                    .then(() => {
                        authMessage.textContent = 'Sign up successful!';
                        transferLocalToFirestore();
                    })
                    .catch(e => authMessage.textContent = `Error: ${e.message}`);
            });

            logoutButton.addEventListener('click', () => {
                auth.signOut().then(() => authMessage.textContent = 'Logged out');
            });

            saveButton.addEventListener('click', saveToFirestore);

            // Game logic
            mainButton.addEventListener('click', e => {
                clickSound.play().catch(() => console.log("Sound failed"));
                count += coinsPerClick * (rebirths + 1);
                coinCount.textContent = count;
                createFlyingCoin(e);
                updateButtons();
                autosave();
            });

            upgradeButton.addEventListener('click', () => {
                if (count >= upgradeCost) {
                    count -= upgradeCost;
                    coinsPerClick++;
                    upgradeLevel++;
                    upgradeCost = Math.floor(10 * Math.pow(upgradeLevel, 2)) || 10;
                    coinCount.textContent = count;
                    upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
                    upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
                    updateButtons();
                    autosave();
                }
            });

            rebirthButton.addEventListener('click', () => {
                if (count >= rebirthCost) {
                    count = 0;
                    coinsPerClick = 1;
                    upgradeLevel = 0;
                    rebirths++;
                    upgradeCost = 10;
                    rebirthCost = Math.floor(1000000 * Math.pow(2, rebirths));
                    coinCount.textContent = count;
                    upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
                    upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
                    rebirthCostLabel.textContent = `Cost: ${rebirthCost}`;
                    rebirthCountLabel.textContent = `Count: ${rebirths}`;
                    updateButtons();
                    autosave();
                }
            });

            settingsToggle.addEventListener('click', () => {
                settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
            });

            document.addEventListener('click', e => {
                if (!settingsPanel.contains(e.target) && e.target !== settingsToggle) {
                    settingsPanel.style.display = 'none';
                }
            });

            // Helper functions
            function updateButtons() {
                upgradeButton.disabled = count < upgradeCost;
                rebirthButton.disabled = count < rebirthCost;
            }

            function createFlyingCoin(e) {
                const coin = document.createElement('img');
                coin.src = defaultSkin;
                coin.className = 'flying-coin';
                const rect = mainButton.getBoundingClientRect();
                coin.style.left = (e.clientX - rect.left - 16) + 'px';
                coin.style.top = (e.clientY - rect.top - 16) + 'px';
                document.body.appendChild(coin);
                setTimeout(() => coin.remove(), 1000);
            }

            function autosave() {
                localStorage.setItem('coinCount', count);
                localStorage.setItem('coinsPerClick', coinsPerClick);
                localStorage.setItem('upgradeLevel', upgradeLevel);
                localStorage.setItem('rebirths', rebirths);
                localStorage.setItem('upgradeCost', upgradeCost);
                localStorage.setItem('rebirthCost', rebirthCost);
            }

            function saveToFirestore() {
                if (!user) {
                    authMessage.textContent = 'Log in to save';
                    return;
                }
                const data = {
                    coinCount: count,
                    coinsPerClick: coinsPerClick,
                    upgradeLevel: upgradeLevel,
                    rebirths: rebirths,
                    upgradeCost: upgradeCost,
                    rebirthCost: rebirthCost
                };
                db.collection('users').doc(user.uid).set(data)
                    .then(() => authMessage.textContent = 'Saved to cloud!')
                    .catch(e => authMessage.textContent = `Save error: ${e.message}`);
            }

            function loadFromFirestore() {
                if (!user) return;
                db.collection('users').doc(user.uid).get()
                    .then(doc => {
                        if (doc.exists) {
                            const data = doc.data();
                            count = data.coinCount || 0;
                            coinsPerClick = data.coinsPerClick || 1;
                            upgradeLevel = data.upgradeLevel || 0;
                            rebirths = data.rebirths || 0;
                            upgradeCost = data.upgradeCost || 10;
                            rebirthCost = data.rebirthCost || 1000000;
                            coinCount.textContent = count;
                            upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
                            upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
                            rebirthCostLabel.textContent = `Cost: ${rebirthCost}`;
                            rebirthCountLabel.textContent = `Count: ${rebirths}`;
                            updateButtons();
                            autosave();
                        }
                    })
                    .catch(e => authMessage.textContent = `Load error: ${e.message}`);
            }

            function transferLocalToFirestore() {
                if (user) saveToFirestore();
            }

            console.log("Game loaded");
        };
    </script>
</body>
</html>
