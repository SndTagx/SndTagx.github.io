<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SndTagXClicker</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            background: linear-gradient(45deg, #1e1e2f, #3b3b5e);
            font-family: Arial, sans-serif;
            color: #e0e0e0;
            user-select: none;
        }
        #mainButton {
            width: 100%;
            height: 100vh;
            background-size: cover;
            background-position: center;
            border: none;
            cursor: pointer;
            outline: none;
            transition: transform 0.2s ease;
        }
        #mainButton:hover { transform: scale(1.02); }
        #mainButton:active { transform: scale(0.98); }
        #clickArea {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 26px;
            display: flex;
            align-items: center;
            background: rgba(20, 20, 40, 0.9);
            padding: 8px 12px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 150;
        }
        #coinIcon { width: 32px; height: 32px; margin-right: 10px; }
        #coinCount { font-size: 26px; }
        .flying-coin {
            position: absolute;
            width: 32px;
            height: 32px;
            pointer-events: none;
            animation: flyUp 1s ease-out forwards;
        }
        @keyframes flyUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(0.8); }
        }
        #upgradeButton, #rebirthButton {
            position: absolute;
            bottom: 10px;
            padding: 8px 12px;
            background-size: cover;
            border: none;
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            width: 150px;
            height: 45px;
            z-index: 100;
        }
        #upgradeButton { left: 10px; }
        #rebirthButton { right: 10px; }
        #upgradeButton:disabled, #rebirthButton:disabled { opacity: 0.6; cursor: not-allowed; }
        #upgradeCostLabel, #rebirthCostLabel, #upgradeCountLabel, #rebirthCountLabel {
            position: absolute;
            font-size: 12px;
            padding: 4px 6px;
            border-radius: 8px;
            background: #000;
            z-index: 100;
        }
        #upgradeCostLabel { bottom: 60px; left: 10px; color: #00b4db; }
        #upgradeCountLabel { bottom: 80px; left: 10px; color: #00b4db; }
        #rebirthCostLabel { bottom: 60px; right: 10px; color: #ff4d4d; }
        #rebirthCountLabel { bottom: 80px; right: 10px; color: #ff4d4d; }
        #settingsToggle {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background: #1e1e2f;
            border: 2px solid #173a5b;
            border-radius: 50%;
            color: #fff;
            font-size: 26px;
            cursor: pointer;
            z-index: 101;
        }
        #settingsPanel {
            position: absolute;
            top: 60px;
            right: 10px;
            width: 300px;
            background: rgba(20, 20, 40, 0.95);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.6);
            display: none;
            z-index: 100;
        }
        .setting-option {
            display: flex;
            align-items: center;
            padding: 8px;
            margin: 4px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            font-size: 15px;
            flex-wrap: wrap;
        }
        #exportSaveText, #importSaveText {
            width: 100%;
            height: 60px;
            resize: none;
            padding: 5px;
            margin-top: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
            font-size: 14px;
        }
        #exportSaveText { margin-bottom: 10px; }
        #settingsPanel input, #settingsPanel button {
            padding: 5px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        #settingsPanel button {
            background: #ff4d4d;
            border: none;
            color: #fff;
            cursor: pointer;
        }
        #settingsPanel button:hover {
            background: #e03c3c;
        }
        #authMessage { font-size: 12px; margin-top: 5px; }
    </style>
</head>
<body>
    <button id="mainButton"></button>
    <div id="clickArea">
        <img id="coinIcon" alt="Coin">
        <span id="coinCount">0</span>
    </div>
    <div id="upgradeCountLabel">Count: 0</div>
    <div id="upgradeCostLabel">Cost: 10</div>
    <button id="upgradeButton">Upgrade</button>
    <div id="rebirthCountLabel">Count: 0</div>
    <div id="rebirthCostLabel">Cost: 1000000</div>
    <button id="rebirthButton">Rebirth</button>
    <button id="settingsToggle">âš™</button>
    <div id="settingsPanel">
        <div class="setting-option">
            <input type="text" id="skinInput" placeholder="Skin URL">
            <button id="applySkinButton">Apply Skin</button>
        </div>
        <div class="setting-option">
            <button id="exportSaveButton">Export Save</button>
            <textarea id="exportSaveText" readonly placeholder="Click 'Export Save' to get your save code"></textarea>
        </div>
        <div class="setting-option">
            <button id="importSaveButton">Import Save</button>
            <textarea id="importSaveText" placeholder="Paste your save code here"></textarea>
        </div>
        <div class="setting-option">
            <button id="resetButton">Reset Game</button>
        </div>
    </div>
    <audio id="clickSound"></audio>

    <script>
        window.onload = function() {
            const mainButton = document.getElementById('mainButton');
            const coinCount = document.getElementById('coinCount');
            const coinIcon = document.getElementById('coinIcon');
            const upgradeButton = document.getElementById('upgradeButton');
            const rebirthButton = document.getElementById('rebirthButton');
            const upgradeCostLabel = document.getElementById('upgradeCostLabel');
            const upgradeCountLabel = document.getElementById('upgradeCountLabel');
            const rebirthCostLabel = document.getElementById('rebirthCostLabel');
            const rebirthCountLabel = document.getElementById('rebirthCountLabel');
            const clickSound = document.getElementById('clickSound');
            const settingsToggle = document.getElementById('settingsToggle');
            const settingsPanel = document.getElementById('settingsPanel');
            const skinInput = document.getElementById('skinInput');
            const applySkinButton = document.getElementById('applySkinButton');
            const exportSaveButton = document.getElementById('exportSaveButton');
            const exportSaveText = document.getElementById('exportSaveText');
            const importSaveButton = document.getElementById('importSaveButton');
            const importSaveText = document.getElementById('importSaveText');
            const resetButton = document.getElementById('resetButton');

            // Default values
            const defaultSkin = "Skins/SvetlanaSkin.jpg";
            const defaultSound = "Sounds/SvetlanaSkin.mp3";
            const defaultData = {
                count: 0,
                coinsPerClick: 1,
                upgradeLevel: 0,
                rebirths: 0,
                upgradeCost: 10,
                rebirthCost: 1000000,
                currentSkin: defaultSkin,
                currentSound: defaultSound,
                skins: [
                    { skin: "Skins/SvetlanaSkin.jpg", cost: 0, name: "ðŸ”¢Svetlana (Free)", sound: "Sounds/SvetlanaSkin.mp3" },
                    { skin: "Skins/Skin2.jpg", cost: 100, name: "Skin2", sound: "Sounds/Skin2.mp3" }
                ],
                achievements: {
                    firstClick: false,
                    tenUpgrades: false,
                    firstRebirth: false
                }
            };

            // Load or convert data
            let gameData = loadGameData();
            let count = gameData.count;
            let coinsPerClick = gameData.coinsPerClick;
            let upgradeLevel = gameData.upgradeLevel;
            let rebirths = gameData.rebirths;
            let upgradeCost = gameData.upgradeCost;
            let rebirthCost = gameData.rebirthCost;
            let currentSkin = gameData.currentSkin;
            let currentSound = gameData.currentSound;
            let skins = gameData.skins;
            let achievements = gameData.achievements;

            // Initial setup
            mainButton.style.backgroundImage = `url('${currentSkin}')`;
            upgradeButton.style.backgroundImage = `url('${currentSkin}')`;
            rebirthButton.style.backgroundImage = `url('${currentSkin}')`;
            coinIcon.src = currentSkin;
            clickSound.src = currentSound;
            coinCount.textContent = count;
            upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
            upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
            rebirthCostLabel.textContent = `Cost: ${rebirthCost}`;
            rebirthCountLabel.textContent = `Count: ${rebirths}`;
            updateButtons();
            checkAchievements();

            // Game logic
            mainButton.addEventListener('click', e => {
                clickSound.play().catch(() => console.log("Sound failed"));
                count += coinsPerClick * (rebirths + 1);
                coinCount.textContent = count;
                createFlyingCoin(e);
                if (!achievements.firstClick) {
                    achievements.firstClick = true;
                    alert("Achievement Unlocked: First Click!");
                }
                updateButtons();
                saveGameData();
            });

            upgradeButton.addEventListener('click', () => {
                if (count >= upgradeCost) {
                    count -= upgradeCost;
                    coinsPerClick++;
                    upgradeLevel++;
                    upgradeCost = Math.floor(10 * Math.pow(upgradeLevel, 2)) || 10;
                    coinCount.textContent = count;
                    upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
                    upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
                    if (upgradeLevel >= 10 && !achievements.tenUpgrades) {
                        achievements.tenUpgrades = true;
                        alert("Achievement Unlocked: 10 Upgrades!");
                    }
                    updateButtons();
                    saveGameData();
                }
            });

            rebirthButton.addEventListener('click', () => {
                if (count >= rebirthCost) {
                    count = 0;
                    coinsPerClick = 1;
                    upgradeLevel = 0;
                    rebirths++;
                    upgradeCost = 10;
                    rebirthCost = Math.floor(1000000 * Math.pow(2, rebirths));
                    coinCount.textContent = count;
                    upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
                    upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
                    rebirthCostLabel.textContent = `Cost: ${rebirthCost}`;
                    rebirthCountLabel.textContent = `Count: ${rebirths}`;
                    if (!achievements.firstRebirth) {
                        achievements.firstRebirth = true;
                        alert("Achievement Unlocked: First Rebirth!");
                    }
                    updateButtons();
                    saveGameData();
                }
            });

            // Settings panel
            settingsToggle.addEventListener('click', () => {
                settingsPanel.style.display = settingsPanel.style.display === 'block' ? 'none' : 'block';
            });

            document.addEventListener('click', e => {
                if (!settingsPanel.contains(e.target) && e.target !== settingsToggle) {
                    settingsPanel.style.display = 'none';
                }
            });

            applySkinButton.addEventListener('click', () => {
                const newSkin = skinInput.value.trim();
                if (newSkin) {
                    currentSkin = newSkin;
                    mainButton.style.backgroundImage = `url('${currentSkin}')`;
                    upgradeButton.style.backgroundImage = `url('${currentSkin}')`;
                    rebirthButton.style.backgroundImage = `url('${currentSkin}')`;
                    coinIcon.src = currentSkin;
                    saveGameData();
                    skinInput.value = '';
                }
            });

            exportSaveButton.addEventListener('click', () => {
                const data = {
                    count: count,
                    coinsPerClick: coinsPerClick,
                    upgradeLevel: upgradeLevel,
                    rebirths: rebirths,
                    upgradeCost: upgradeCost,
                    rebirthCost: rebirthCost,
                    currentSkin: currentSkin,
                    currentSound: currentSound,
                    skins: skins,
                    achievements: achievements
                };
                const encodedData = btoa(JSON.stringify(data));
                exportSaveText.value = encodedData;
            });

            importSaveButton.addEventListener('click', () => {
                const inputData = importSaveText.value.trim();
                if (!inputData) {
                    alert("Please paste a save code to import.");
                    return;
                }
                try {
                    const decodedData = JSON.parse(atob(inputData));
                    count = decodedData.count || 0;
                    coinsPerClick = decodedData.coinsPerClick || 1;
                    upgradeLevel = decodedData.upgradeLevel || 0;
                    rebirths = decodedData.rebirths || 0;
                    upgradeCost = decodedData.upgradeCost || 10;
                    rebirthCost = decodedData.rebirthCost || 1000000;
                    currentSkin = decodedData.currentSkin || defaultSkin;
                    currentSound = decodedData.currentSound || defaultSound;
                    skins = decodedData.skins || defaultData.skins;
                    achievements = decodedData.achievements || defaultData.achievements;
                    coinCount.textContent = count;
                    upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
                    upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
                    rebirthCostLabel.textContent = `Cost: ${rebirthCost}`;
                    rebirthCountLabel.textContent = `Count: ${rebirths}`;
                    mainButton.style.backgroundImage = `url('${currentSkin}')`;
                    upgradeButton.style.backgroundImage = `url('${currentSkin}')`;
                    rebirthButton.style.backgroundImage = `url('${currentSkin}')`;
                    coinIcon.src = currentSkin;
                    clickSound.src = currentSound;
                    updateButtons();
                    saveGameData();
                    importSaveText.value = '';
                    alert("Save imported successfully!");
                } catch (e) {
                    alert("Invalid save code. Please check and try again.");
                }
            });

            resetButton.addEventListener('click', () => {
                if (confirm("Are you sure you want to reset all progress? This cannot be undone.")) {
                    count = 0;
                    coinsPerClick = 1;
                    upgradeLevel = 0;
                    rebirths = 0;
                    upgradeCost = 10;
                    rebirthCost = 1000000;
                    currentSkin = defaultSkin;
                    currentSound = defaultSound;
                    skins = defaultData.skins;
                    achievements = defaultData.achievements;
                    coinCount.textContent = count;
                    upgradeCostLabel.textContent = `Cost: ${upgradeCost}`;
                    upgradeCountLabel.textContent = `Count: ${upgradeLevel}`;
                    rebirthCostLabel.textContent = `Cost: ${rebirthCost}`;
                    rebirthCountLabel.textContent = `Count: ${rebirths}`;
                    mainButton.style.backgroundImage = `url('${currentSkin}')`;
                    upgradeButton.style.backgroundImage = `url('${currentSkin}')`;
                    rebirthButton.style.backgroundImage = `url('${currentSkin}')`;
                    coinIcon.src = currentSkin;
                    clickSound.src = currentSound;
                    updateButtons();
                    saveGameData();
                    exportSaveText.value = '';
                    importSaveText.value = '';
                }
            });

            // Helper functions
            function updateButtons() {
                upgradeButton.disabled = count < upgradeCost;
                rebirthButton.disabled = count < rebirthCost;
            }

            function createFlyingCoin(e) {
                const coin = document.createElement('img');
                coin.src = currentSkin;
                coin.className = 'flying-coin';
                const rect = mainButton.getBoundingClientRect();
                coin.style.left = (e.clientX - rect.left - 16) + 'px';
                coin.style.top = (e.clientY - rect.top - 16) + 'px';
                document.body.appendChild(coin);
                setTimeout(() => coin.remove(), 1000);
            }

            function checkAchievements() {
                if (count > 0 && !achievements.firstClick) achievements.firstClick = true;
                if (upgradeLevel >= 10 && !achievements.tenUpgrades) achievements.tenUpgrades = true;
                if (rebirths > 0 && !achievements.firstRebirth) achievements.firstRebirth = true;
            }

            function saveGameData() {
                const data = {
                    count: count,
                    coinsPerClick: coinsPerClick,
                    upgradeLevel: upgradeLevel,
                    rebirths: rebirths,
                    upgradeCost: upgradeCost,
                    rebirthCost: rebirthCost,
                    currentSkin: currentSkin,
                    currentSound: currentSound,
                    skins: skins,
                    achievements: achievements
                };
                const encodedData = btoa(JSON.stringify(data));
                localStorage.setItem('sndtagx_save', encodedData);
            }

            function loadGameData() {
                const savedData = localStorage.getItem('sndtagx_save');
                if (savedData) {
                    try {
                        return JSON.parse(atob(savedData));
                    } catch (e) {
                        console.log("Invalid save data, converting old format");
                    }
                }

                // Convert old LocalStorage format
                const oldData = {
                    count: parseInt(localStorage.getItem('coinCount')) || 0,
                    coinsPerClick: parseInt(localStorage.getItem('coinsPerClick')) || 1,
                    upgradeLevel: parseInt(localStorage.getItem('upgradeLevel')) || 0,
                    rebirths: parseInt(localStorage.getItem('rebirths')) || 0,
                    upgradeCost: parseInt(localStorage.getItem('upgradeCost')) || 10,
                    rebirthCost: parseInt(localStorage.getItem('rebirthCost')) || 1000000,
                    currentSkin: localStorage.getItem('currentSkin') || defaultSkin,
                    currentSound: localStorage.getItem('currentSound') || defaultSound,
                    skins: JSON.parse(localStorage.getItem('skins')) || defaultData.skins,
                    achievements: JSON.parse(localStorage.getItem('achievements')) || defaultData.achievements
                };

                // Save in new format and clean up old keys
                saveGameDataFromObject(oldData);
                localStorage.removeItem('coinCount');
                localStorage.removeItem('coinsPerClick');
                localStorage.removeItem('upgradeLevel');
                localStorage.removeItem('rebirths');
                localStorage.removeItem('upgradeCost');
                localStorage.removeItem('rebirthCost');
                localStorage.removeItem('currentSkin');
                localStorage.removeItem('currentSound');
                localStorage.removeItem('skins');
                localStorage.removeItem('achievements');

                return oldData;
            }

            function saveGameDataFromObject(data) {
                const encodedData = btoa(JSON.stringify(data));
                localStorage.setItem('sndtagx_save', encodedData);
            }

            console.log("Game loaded");
        };
    </script>
</body>
</html>
